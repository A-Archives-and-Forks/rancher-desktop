#!/bin/sh

set -eu

command=

usage() {
  echo "USAGE: "
  echo
  echo "list

echo URL | get

echo '{ ServerURL: URL, user: USER, secret: SECRET }' | store

echo URL | erase"
  exit 1
}

case $# in
  0) usage ;;
  1) command=$1 ;;
  *) echo "Too many arguments given." ; usage ;;
esac

source /etc/rancher/desktop/credfwd
case $command in
  list) arg="" ;;
  get|store|erase) arg=$(cat) ;;
  *) echo "Unrecognized command '$command'." ; usage ;;
esac

curl --user "$CREDFWD_AUTH"  --data "${arg}" --noproxy '*' --fail-with-body "$CREDFWD_URL/$command" 2>/dev/null
